webpackJsonp([103],{"7U2o":function(t,e,a){"use strict";function i(t){a("jB58")}Object.defineProperty(e,"__esModule",{value:!0});var s=a("mvHQ"),n=a.n(s),o=a("YxJB"),r=a("0eEN"),l=a("Fiy/"),c=(o.a,r.a,l.a,{name:"rwgl",components:{Flexbox:o.a,fhPopup:r.a,fhImgWord:l.a},data:function(){return{curUserInfo:JSON.parse(localStorage.getItem("userInfo")),popShow:!1,detailShow:!1,searchShow:!1,editShow:!1,evaluateShow:!1,evaluateModifyShow:!1,listHeight:0,nodata:!1,idata:{missionId:"",missionPid:"",content:"",level:"1",credit:"1",createTime:"",getTime:"",finishTime:"",status:"",scoreTime:"",description:"",userId:""},listData:[],detailData:{},searchData:{keyword:"",status:[]},radarData:[],statusList:[{title:"未开始",value:"1"},{title:"进行中",value:"2"},{title:"已完成",value:"3"},{title:"已终止",value:"4"},{title:"已评级",value:"5"}],creditList:[],total:0,playerLevel:0}},methods:{onClickLeft:function(){this.$router?this.$router.back():window.history.back()},onFilter:function(){this.searchShow=!0},doAdd:function(){var t=this;if(0===this.idata.content.trim().length)return void this.$toast(this.$msgJson.all_needMust);var e=(new Date).getTime();this.idata.createTime=e,this.idata.missionId=this.$uuid(),this.idata.status=1,this.$insert("mission",this.idata,function(e){"0"===e.code?(t.$toast(t.$msgJson.all_doSucc),t.popShow=!1,t.getList()):t.$toast(t.$msgJson.all_insertFail)})},showDetail:function(t){var e=this;this.detailShow=!0,this.$query_by_primaryKey("mission",t,function(t){e.detailData=t.data.data})},getList:function(){var t=this;this.$query("mission",function(e){return e.userId==t.curUserInfo.userId&&-1!=e.content.indexOf(t.searchData.keyword.trim())&&(0===t.searchData.status.length||t.searchData.status.includes(e.status+""))},function(e){0===e.data.data.length?t.nodata=!0:(t.nodata=!1,t.listData=e.data.data,t.listData.sort(t.soryBy("createTime",!1)))})},soryBy:function(t,e){return function(a,i){var s=a[t],n=i[t];return void 0==e?s-n:e?s-n:n-s}},tranStatus:function(t){var e="";switch(t){case 1:e="未开始";break;case 2:e="进行中";break;case 3:e="已完成";break;case 4:e="已终止";break;case 5:e="已评级"}return e},doSearch:function(){this.searchShow=!1,this.getList()},doReset:function(){this.searchData.status=[]},xinjian:function(){this.idata={missionId:"",missionPid:"",content:"",level:"1",credit:"1",createTime:"",getTime:"",finishTime:"",status:"",scoreTime:"",description:"",userId:this.curUserInfo.userId},this.popShow=!0},qiyong:function(t){var e=this;this.$dialog.confirm({message:this.$msgJson.rwgl_startMission}).then(function(){if(e.playerLevel<t.level)return void e.$toast(e.$msgJson.rwgl_startMissionLevel+t.level+"级");e.$update_by_primaryKey("mission",t.missionId,function(t){return t.status=2,t.getTime=(new Date).getTime()},function(t){e.getList()})}).catch(function(){})},bianji:function(t){this.idata=JSON.parse(n()(t)),this.editShow=!0},doEdit:function(){var t=this;if(0===this.idata.content.trim().length)return void this.$toast(this.$msgJson.all_needMust);this.$update_by_primaryKey("mission",this.idata.missionId,function(e){return e.content=t.idata.content,e.credit=t.idata.credit,e.level=t.idata.level},function(e){t.editShow=!1,t.getList()})},shanchu:function(t){var e=this;this.$dialog.confirm({message:this.$msgJson.all_delConfirm}).then(function(){e.$delete_by_primaryKey("mission",t.missionId,function(t){e.getList()})}).catch(function(){})},wancheng:function(t){var e=this;this.$dialog.confirm({message:this.$msgJson.rwgl_finishMission}).then(function(){e.$update_by_primaryKey("mission",t.missionId,function(t){return t.status=3,t.finishTime=(new Date).getTime()},function(a){e.getList(),e.addCredit(t)})}).catch(function(){})},zhongzhi:function(t){var e=this;this.$dialog.confirm({message:this.$msgJson.rwgl_stopMission}).then(function(){e.$update_by_primaryKey("mission",t.missionId,function(t){return t.status=4,t.finishTime=(new Date).getTime()},function(t){e.getList()})}).catch(function(){})},pingji:function(t){var e=this;this.idata=JSON.parse(n()(t)),this.evaluateShow=!0,this.$query("radar",function(t){return t.userId==e.curUserInfo.userId},function(t){e.radarData=t.data.data})},pingjiModify:function(t){var e=this;this.idata=JSON.parse(n()(t)),this.evaluateModifyShow=!0,this.$query("radar",function(t){return t.userId==e.curUserInfo.userId},function(a){var i=a.data.data;e.$query("radarScore",function(e){return e.missionId==t.missionId},function(t){var a=t.data.data;i.forEach(function(t){a.forEach(function(e){e.radarId==t.radarId&&(t.score=e.score)})}),e.radarData=i})})},doEvaluate:function(){var t=this,e=(new Date).getTime();this.$update_by_primaryKey("mission",this.idata.missionId,function(a){return a.status=5,a.description=t.idata.description,a.scoreTime=e},function(a){t.evaluateShow=!1,t.getList();var i=[];t.radarData.forEach(function(a){if(a.score){var s={scoreId:t.$uuid(),missionId:t.idata.missionId,radarId:a.radarId,name:a.name,score:a.score,description:t.idata.description,scoreTime:e,userId:t.curUserInfo.userId};i.push(s)}}),t.$insert("radarScore",i,function(e){t.$toast(t.$msgJson.mbgl_addScore)})})},doEvaluateModify:function(){var t=this,e=(new Date).getTime();this.$update_by_primaryKey("mission",this.idata.missionId,function(a){return a.description=t.idata.description,a.scoreTime=e},function(a){var i=[];t.radarData.forEach(function(a){if(a.score){var s={scoreId:t.$uuid(),missionId:t.idata.missionId,radarId:a.radarId,name:a.name,score:a.score,description:t.idata.description,scoreTime:e,userId:t.curUserInfo.userId};i.push(s)}}),t.$query("radarScore",function(e){return e.missionId==t.idata.missionId},function(e){0===e.data.data.length?t.$insert("radarScore",i,function(e){t.evaluateModifyShow=!1,t.getList(),t.$toast(t.$msgJson.mbgl_addScore)}):t.$delete_by_func("radarScore",function(e){return e.missionId==t.idata.missionId},function(e){t.$insert("radarScore",i,function(e){t.evaluateModifyShow=!1,t.getList(),t.$toast(t.$msgJson.mbgl_addScore)})})})})},fuzhi:function(t){this.idata={missionId:"",missionPid:t.missionId,content:t.content,level:t.level,credit:t.credit,createTime:"",getTime:"",finishTime:"",status:"",scoreTime:"",description:"",userId:this.curUserInfo.userId},this.popShow=!0},addCredit:function(t){var e=this,a=(new Date).getTime(),i={creditId:this.$uuid(),resourceType:"任务奖励",content:t.content,credit:t.credit,createTime:a,userId:this.curUserInfo.userId};this.$insert("credit",i,function(a){"0"===a.code?(e.$toast(e.$msgJson.jfgl_congratulate+t.credit+"积分"),e.getCreditList()):e.$toast(e.$msgJson.all_insertFail)})},getCreditList:function(){var t=this;this.total=0,this.$query("credit",function(e){return e.userId==t.curUserInfo.userId},function(e){t.creditList=e.data.data,t.creditList.forEach(function(e){1*e.credit>0&&(t.total=t.total+1*e.credit)}),t.getPlayerLevel()})},getPlayerLevel:function(){this.playerLevel=Math.floor(Math.sqrt(this.total))+1}},mounted:function(){var t=window.innerHeight-48-58-58;this.listHeight=t,window.location.href.indexOf("from=lrw")>-1&&(this.searchData.status=["1"]),this.getList(),this.getCreditList()}}),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("fh-nav-bar",{attrs:{title:"任务管理",lefttext:"返回",leftarrow:"",fixed:""},on:{"click-left":t.onClickLeft}}),t._v(" "),a("van-search",{staticClass:"myView",attrs:{"show-action":"",placeholder:this.$msgJson.all_keyword},on:{search:t.getList},model:{value:t.searchData.keyword,callback:function(e){t.$set(t.searchData,"keyword",e)},expression:"searchData.keyword"}},[a("div",{attrs:{slot:"action"},on:{click:t.onFilter},slot:"action"},[a("i",{staticClass:"aidicon aidicon-filter"})])]),t._v(" "),a("div",{staticClass:"listDiv",style:{height:t.listHeight+"px","overflow-y":"auto","background-color":"#ECECEC"},attrs:{id:"list"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.nodata,expression:"!nodata"}]},t._l(t.listData,function(e){return a("van-cell-group",{key:e.missionId,staticClass:"group",on:{click:function(a){return t.showDetail(e.missionId)}}},[a("van-cell",{attrs:{title:e.content,"title-class":"content"}}),t._v(" "),a("van-cell",{attrs:{title:"任务状态",value:t.tranStatus(e.status),"value-class":"status"}}),t._v(" "),a("van-cell",{attrs:{title:"任务等级",value:e.level+"级任务","value-class":"level"}}),t._v(" "),a("van-cell",{attrs:{title:"奖励积分",value:e.credit+"积分","value-class":"credit"}}),t._v(" "),a("div",{staticClass:"opts"},[a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.status,expression:"item.status === 1"}],staticClass:"optBtn",on:{click:function(a){return a.stopPropagation(),t.qiyong(e)}}},[t._v("启用")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.status,expression:"item.status === 1"}],staticClass:"optBtn",on:{click:function(a){return a.stopPropagation(),t.bianji(e)}}},[t._v("编辑")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.status,expression:"item.status === 1"}],staticClass:"optBtn",on:{click:function(a){return a.stopPropagation(),t.shanchu(e)}}},[t._v("删除")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2===e.status,expression:"item.status === 2"}],staticClass:"optBtn",on:{click:function(a){return a.stopPropagation(),t.wancheng(e)}}},[t._v("完成")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2===e.status,expression:"item.status === 2"}],staticClass:"optBtn",on:{click:function(a){return a.stopPropagation(),t.zhongzhi(e)}}},[t._v("终止")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:3===e.status||4===e.status,expression:"item.status === 3 || item.status === 4"}],staticClass:"optBtn",on:{click:function(a){return a.stopPropagation(),t.pingji(e)}}},[t._v("评级")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:5===e.status,expression:"item.status === 5"}],staticClass:"optBtn",on:{click:function(a){return a.stopPropagation(),t.pingjiModify(e)}}},[t._v("修改评级")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:3===e.status||4===e.status||5===e.status,expression:"item.status === 3 || item.status === 4 || item.status === 5"}],staticClass:"optBtn",on:{click:function(a){return a.stopPropagation(),t.fuzhi(e)}}},[t._v("复制")])])],1)}),1),t._v(" "),a("fhImgWord",{directives:[{name:"show",rawName:"v-show",value:t.nodata,expression:"nodata"}],attrs:{width:"144",height:"119"}})],1),t._v(" "),a("flexbox",{staticClass:"actions"},[a("button",{staticClass:"fh-theme-bgcolor",on:{click:t.xinjian}},[t._v("新建任务")])]),t._v(" "),a("fhPopup",{attrs:{height:"75%"},model:{value:t.popShow,callback:function(e){t.popShow=e},expression:"popShow"}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("新建任务")]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"divBotPad"},[a("van-field",{attrs:{label:"任务内容",placeholder:this.$msgJson.mission_contentLabel,clearable:"",required:"",type:"textarea",rows:"3"},model:{value:t.idata.content,callback:function(e){t.$set(t.idata,"content",e)},expression:"idata.content"}}),t._v(" "),a("van-cell",{attrs:{center:"",title:"任务等级",label:this.$msgJson.mission_levelLabel}},[a("van-stepper",{model:{value:t.idata.level,callback:function(e){t.$set(t.idata,"level",e)},expression:"idata.level"}})],1),t._v(" "),a("van-cell",{attrs:{center:"",title:"奖励积分",label:this.$msgJson.mission_creditLabel}},[a("van-stepper",{model:{value:t.idata.credit,callback:function(e){t.$set(t.idata,"credit",e)},expression:"idata.credit"}})],1)],1),t._v(" "),a("flexbox",{staticClass:"actions"},[a("button",{staticClass:"fh-theme-bgcolor",on:{click:t.doAdd}},[t._v("确认提交")])])],1)]),t._v(" "),a("fhPopup",{attrs:{height:"75%"},model:{value:t.detailShow,callback:function(e){t.detailShow=e},expression:"detailShow"}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("任务详情")]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"divBotPad"},[a("van-cell",{attrs:{title:"任务内容",value:t.detailData.content}}),t._v(" "),a("van-cell",{attrs:{title:"任务等级",value:t.detailData.level+"级任务"}}),t._v(" "),a("van-cell",{attrs:{title:"奖励积分",value:t.detailData.credit+"积分"}}),t._v(" "),a("van-cell",{attrs:{title:"任务状态",value:t.tranStatus(t.detailData.status)}}),t._v(" "),a("van-cell",{attrs:{title:"创建时间",value:t._f("formatDate")(t.detailData.createTime)}}),t._v(" "),a("van-cell",{attrs:{title:"领取时间",value:t._f("formatDate")(t.detailData.getTime)}}),t._v(" "),a("van-cell",{attrs:{title:"完成时间",value:t._f("formatDate")(t.detailData.finishTime)}}),t._v(" "),a("van-cell",{attrs:{title:"评级时间",value:t._f("formatDate")(t.detailData.scoreTime)}}),t._v(" "),a("van-cell",{attrs:{title:"评级备注",value:t.detailData.description}})],1)])]),t._v(" "),a("fhPopup",{attrs:{height:"75%"},model:{value:t.searchShow,callback:function(e){t.searchShow=e},expression:"searchShow"}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("筛选")]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"divBotPad"},[a("van-cell",{attrs:{center:"",title:"任务状态","title-class":"bold"}}),t._v(" "),a("van-checkbox-group",{model:{value:t.searchData.status,callback:function(e){t.$set(t.searchData,"status",e)},expression:"searchData.status"}},[a("van-cell-group",t._l(t.statusList,function(e,i){return a("van-cell",{key:i,attrs:{clickable:"",title:e.title},scopedSlots:t._u([{key:"right-icon",fn:function(){return[a("van-checkbox",{ref:"checkboxes",refInFor:!0,attrs:{name:e.value}})]},proxy:!0}],null,!0)})}),1)],1)],1),t._v(" "),a("flexbox",{staticClass:"actions"},[a("button",{staticClass:"fh-theme-opacity",on:{click:t.doReset}},[t._v("重置")]),t._v(" "),a("button",{staticClass:"fh-theme-bgcolor",on:{click:t.doSearch}},[t._v("完成")])])],1)]),t._v(" "),a("fhPopup",{attrs:{height:"75%"},model:{value:t.editShow,callback:function(e){t.editShow=e},expression:"editShow"}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("编辑任务")]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"divBotPad"},[a("van-field",{attrs:{label:"任务内容",placeholder:this.$msgJson.mission_contentLabel,clearable:"",required:"",type:"textarea",rows:"3"},model:{value:t.idata.content,callback:function(e){t.$set(t.idata,"content",e)},expression:"idata.content"}}),t._v(" "),a("van-cell",{attrs:{center:"",title:"任务等级",required:"",label:this.$msgJson.mission_levelLabel}},[a("van-stepper",{model:{value:t.idata.level,callback:function(e){t.$set(t.idata,"level",e)},expression:"idata.level"}})],1),t._v(" "),a("van-cell",{attrs:{center:"",title:"奖励积分",required:"",label:this.$msgJson.mission_creditLabel}},[a("van-stepper",{model:{value:t.idata.credit,callback:function(e){t.$set(t.idata,"credit",e)},expression:"idata.credit"}})],1)],1),t._v(" "),a("flexbox",{staticClass:"actions"},[a("button",{staticClass:"fh-theme-bgcolor",on:{click:t.doEdit}},[t._v("确认提交")])])],1)]),t._v(" "),a("fhPopup",{attrs:{height:"75%"},model:{value:t.evaluateShow,callback:function(e){t.evaluateShow=e},expression:"evaluateShow"}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("任务评级")]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"divBotPad"},[t._l(t.radarData,function(e){return a("van-cell",{key:e.radarId,attrs:{center:"",title:e.name,label:e.description}},[a("van-rate",{attrs:{size:"25","allow-half":"","void-icon":"star","void-color":"#eee"},model:{value:e.score,callback:function(a){t.$set(e,"score",a)},expression:"item.score"}})],1)}),t._v(" "),a("van-field",{attrs:{label:"评级备注",placeholder:this.$msgJson.rwgl_evaluateLabel,clearable:"",type:"textarea",rows:"4"},model:{value:t.idata.description,callback:function(e){t.$set(t.idata,"description",e)},expression:"idata.description"}})],2),t._v(" "),a("flexbox",{staticClass:"actions"},[a("button",{staticClass:"fh-theme-bgcolor",on:{click:t.doEvaluate}},[t._v("确认提交")])])],1)]),t._v(" "),a("fhPopup",{attrs:{height:"75%"},model:{value:t.evaluateModifyShow,callback:function(e){t.evaluateModifyShow=e},expression:"evaluateModifyShow"}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("修改评级")]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"divBotPad"},[t._l(t.radarData,function(e){return a("van-cell",{key:e.radarId,attrs:{center:"",title:e.name,label:e.description}},[a("van-rate",{attrs:{size:"25","allow-half":"","void-icon":"star","void-color":"#eee"},model:{value:e.score,callback:function(a){t.$set(e,"score",a)},expression:"item.score"}})],1)}),t._v(" "),a("van-field",{attrs:{label:"评级备注",placeholder:this.$msgJson.rwgl_evaluateLabel,clearable:"",type:"textarea",rows:"4"},model:{value:t.idata.description,callback:function(e){t.$set(t.idata,"description",e)},expression:"idata.description"}})],2),t._v(" "),a("flexbox",{staticClass:"actions"},[a("button",{staticClass:"fh-theme-bgcolor",on:{click:t.doEvaluateModify}},[t._v("确认提交")])])],1)])],1)},u=[],v={render:d,staticRenderFns:u},h=v,f=a("VU/8"),m=i,p=f(c,h,!1,m,"data-v-04625467",null);e.default=p.exports},Y5K8:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,"\n.myView[data-v-04625467] {\n  margin-top: 1.333333rem;\n}\n.actions[data-v-04625467] {\n  height: 1.333333rem;\n  background: #fff;\n  position: fixed;\n  bottom: 0;\n}\nbutton[data-v-04625467] {\n  height: 14vw;\n  -webkit-box-flex: 1;\n  -webkit-flex: auto;\n          flex: auto;\n  color: #ffffff;\n  font-size: 0.453333rem;\n  font-weight: 400;\n  border: none;\n  outline: none;\n  margin-left: 0;\n}\n.divBotPad[data-v-04625467] {\n  padding-bottom: 1.6rem;\n}\n.bold[data-v-04625467] {\n  font-weight: bold;\n}\n.listDiv[data-v-04625467] {\n  padding-bottom: 0.213333rem;\n}\n.group[data-v-04625467] {\n  margin-top: 0.213333rem;\n}\n.content[data-v-04625467] {\n  font-size: 0.426667rem;\n  display: -webkit-box;\n  overflow: hidden;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 3;\n  text-overflow: ellipsis;\n  word-break: break-all;\n}\n\n/*  .status{\n    color: red;\n  }\n  .level{\n    color: red;\n  }\n  .credit{\n    color: red;\n  }*/\n.opts[data-v-04625467] {\n  padding: 0.266667rem 0.426667rem;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n  -webkit-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.optBtn[data-v-04625467] {\n  padding: 0.266667rem 0.266667rem;\n  border: solid 0.026667rem #0354A6;\n  text-align: center;\n  font-size: 0.373333rem;\n  color: #0354A6;\n  margin-left: 0.266667rem;\n}",""])},jB58:function(t,e,a){var i=a("Y5K8");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("133e17d9",i,!0,{})}});